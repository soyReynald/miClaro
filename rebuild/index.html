<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Realtime Chat App</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"/>
</head>
<body>
    <div class="wrapper" id="signupdiv">
      <section class="form signup">
        <header>Realtime Chat App</header>
        <form action="#" method="POST" enctype="multipart/form-data" autocomplete="off">
          <div class="error-text"></div>
          <div class="name-details">
            <div class="field input">
              <label>First Name</label>
              <input type="text" name="fname" placeholder="First name" required>
            </div>
            <div class="field input">
              <label>Last Name</label>
              <input type="text" name="lname" placeholder="Last name" required>
            </div>
          </div>
          <div class="field input">
            <label>Email Address</label>
            <input type="text" name="email" placeholder="Enter your email" required>
          </div>
          <div class="field input">
            <label>Password</label>
            <input type="password" name="password" placeholder="Enter new password" required>
            <i class="fas fa-eye"></i>
          </div>
          <div class="field image">
            <label>Select Image</label>
            <input type="file" name="image" accept="image/x-png,image/gif,image/jpeg,image/jpg" required>
          </div>
          <div class="field button">
            <input type="submit" name="submit" value="Continue to Chat">
          </div>
        </form>
        <div class="link">Already signed up? <a class="loginNowBtn" onclick="showLoginDiv();">Login now</a></div>
      </section>
    </div>
    <div class="wrapper" id="logindiv" style="display: none;">
        <section class="form login">
          <header>Realtime Chat App</header>
          <form action="#" method="POST" enctype="multipart/form-data" autocomplete="off">
            <div class="error-text"></div>
            <div class="field input">
              <label>Email Address</label>
              <input type="text" name="email" placeholder="Enter your email" required>
            </div>
            <div class="field input">
              <label>Password</label>
              <input type="password" name="password" placeholder="Enter your password" required>
              <i class="fas fa-eye"></i>
            </div>
            <div class="field button">
              <input type="submit" name="submit" value="Continue to Chat">
            </div>
          </form>
          <div class="link">Not yet signed up? <a class="signupNowBtn" onclick="showSignupDiv();">Signup now</a></div>
        </section>
    </div>
    <div class="wrapper" id="usersListing" style="display: none;">
      <section class="users">
        <header>
          <div class="content">
            <img src="" alt="" id="userImageProfile"> <!-- php/images/<?php echo $row['img']; ?> -->
            <div class="details">
              <span id="user-fullname"></span>
              <p id="user-status"></p>
            </div>
          </div>
          <a class="logout logout-btn">Logout</a> <!-- php/logout.php?logout_id=<?php echo $row['unique_id']; ?> -->
        </header>
        <div class="search">
          <span class="text">Select an user to start chat</span>
          <input type="text" placeholder="Enter name to search...">
          <button><i class="fas fa-search"></i></button>
        </div>
        <div class="users-list">
    
        </div>
      </section>
    </div>
    <div id="chatSection" class="wrapper" style="display: none;">
      <section class="chat-area">
        <header>
          <a href="users.php" class="back-icon"><i class="fas fa-arrow-left"></i></a>
          <img id="userImage-chat" alt="">
          <div class="details">
            <span id="fullName-chat"></span>
            <p id="status-chat"></p>
          </div>
        </header>
        <div class="chat-box">
  
        </div>
        <form action="#" class="typing-area">
          <input type="text" class="incoming_id" name="incoming_id" hidden>
          <input type="text" name="message" class="input-field" placeholder="Type a message here..." autocomplete="off">
          <button><i class="fab fa-telegram-plane"></i></button>
        </form>
      </section>
    </div>
</body>
<!-- Login -->
<script src="javascript/pass-show-hide.js"></script>
<script src="javascript/login.js"></script>

<!-- Last SRIPTS -->
<script src="javascript/jquery.js"></script>
<script type="text/javascript">
    const $loginDiv = $('#logindiv');
    const $signupDiv = $('#signupdiv');
    const $usersDiv = $('#usersListing');
    const $chatDiv = $('#chatSection');

    const userImage = $('#userImageProfile');
    const userFullName = $('#user-fullname');
    const userStatus = $('#user-status');
    const logoutBtn = $('.users .logout-btn');

    const userImageChat = $('#userImage-chat');
    const fullNameChat = $('#fullName-chat');
    const statusChat = $('#status-chat');
    const incomingID = $('#chatSection form .incoming_id');

    function showLoginDiv(){
        $loginDiv.css("display", "block");
        $signupDiv.css("display", "none");
    }

    function showSignupDiv(){
        $loginDiv.css("display", "none");
        $signupDiv.css("display", "block");
    }

    function showUserListing(){
      $.post('API/user.php',
        {Evento: "getUserDetails"})
      .done(function(data){
        $usersDiv.css("display", "block");
        $loginDiv.css("display", "none");
        
        data = JSON.parse(data);
        userImage.attr('src', 'images/'+data.imageProfile);
        userFullName.text(data.fullName);
        userStatus.text(data.status);
        logoutBtn.attr("href", `API/logout.php?logout_id=${data.uniqueid}`);
      });
    }

    function chat(userID){
      // <a href="chat.php?user_id='. $row['unique_id'] .'">
      $.post('API/chat.php',
        {Evento: "getUserChatDetails", user_id: userID})
      .done(function(data){
        $chatDiv.css("display", "block");
        $usersDiv.css("display", "none");
        data = JSON.parse(data);

        userImageChat.attr('src', 'images/'+data.imageProfile);
        fullNameChat.text(data.fullName);
        statusChat.text(data.status);
        incomingID.attr('value', userID);
      });
    }
</script>

<script src="javascript/users.js"></script>
<script src="javascript/chat.js"></script>
</html>